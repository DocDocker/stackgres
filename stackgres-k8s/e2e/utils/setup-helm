#!/bin/sh

setup_helm() {

  helm repo add stable https://kubernetes-charts.storage.googleapis.com
  
  helm repo update
  
  for CHART_PATH in "$OPERATOR_CHART_PATH" "$CLUSTER_CHART_PATH"
  do
    if [ "$(helm dep list "$CHART_PATH" | tail -n +2 | head -n -1 | grep -v 'ok\s*$' | wc -l)" -gt 0 ]
    then
      helm dependency update --skip-refresh "$CHART_PATH"
    fi
  done
}

is_tiller_loaded() {
  kubectl get pods -n kube-system 2>/dev/null \
    | grep '^tiller-deploy-' \
    | sed 's/ \+/ /g' \
    | cut -d ' ' -f 2 \
    | grep -q '1/1'
}
